{% extends "layout.html" %} {% block content %}
<div class="hero-section">
  <h1>Akıllı Ev Kontrolü</h1>
  <p>Cihazlarını aç/kapat, termostatı ayarla.</p>
</div>

<div class="grid metrics-grid" style="margin-top: 20px">
  <div class="card kpi-card">
    <div class="card-top">
      <h3>İç Sıcaklık</h3>
      <span class="pill live">Canlı</span>
    </div>
    <div class="kpi-value">{{ home_dash.kpis.indoorTemp }}°C</div>
    <p class="text-muted">Son okuma: {{ home_dash.updatedAt }}</p>
  </div>

  <div class="card kpi-card">
    <div class="card-top">
      <h3>Nem</h3>
      <span class="pill">Ortam</span>
    </div>
    <div class="kpi-value">{{ home_dash.kpis.humidity }}%</div>
    <p class="text-muted">Konfor aralığı 35–55%</p>
  </div>

  <div class="card kpi-card">
    <div class="card-top">
      <h3>Aktif Cihaz</h3>
      <span class="pill warning">Takip</span>
    </div>
    <div class="kpi-value">{{ home_dash.kpis.activeDevices }}</div>
    <p class="text-muted">Ağda görünen cihaz</p>
  </div>

  <div class="card kpi-card">
    <div class="card-top">
      <h3>Enerji (Bugün)</h3>
      <span class="pill ghost">Tahmini</span>
    </div>
    <div class="kpi-value">{{ home_dash.kpis.energyToday }} kWh</div>
    <p class="text-muted">Tasarruf modu önerilebilir</p>
  </div>
</div>

<div class="grid" style="margin-top: 20px">
  <div class="card">
    <div class="card-top">
      <h3>Çalışan Sistemler</h3>
      <span class="pill ghost">Rastgele demo</span>
    </div>
    <div class="status-list">
      {% for sys in home_dash.systems %}
      <div class="status-item">
        <span
          class="status-dot {{ 'ok' if sys.status == 'ok' else ('warn' if sys.status == 'warn' else 'error') }}"
        ></span>
        <div>
          <strong>{{ sys.name }}</strong>
          <div class="text-muted">{{ sys.detail }}</div>
        </div>
        <span
          class="status-pill {{ 'ok' if sys.status == 'ok' else ('warn' if sys.status == 'warn' else 'error') }}"
        >
          {{ 'Çalışıyor' if sys.status == 'ok' else ('İzleniyor' if sys.status
          == 'warn' else 'Sorun') }}
        </span>
      </div>
      {% endfor %}
    </div>
  </div>

  <div class="card">
    <div class="card-top">
      <h3>Aktif Cihazlar</h3>
      <span class="pill">Son: {{ home_dash.updatedAt }}</span>
    </div>
    <div class="table-responsive">
      <table class="data-table">
        <thead>
          <tr>
            <th>Cihaz</th>
            <th>Oda</th>
            <th>Durum</th>
            <th>Tüketim</th>
            <th>Son</th>
          </tr>
        </thead>
        <tbody>
          {% for d in home_dash.devices %}
          <tr>
            <td>
              <div style="font-weight: 700">{{ d.name }}</div>
              <div class="text-muted" style="margin-top: 4px">
                <code class="code-inline">{{ d.id }}</code>
              </div>
            </td>
            <td>{{ d.room }}</td>
            <td><span class="pill {{ d.pill }}">{{ d.state }}</span></td>
            <td>{{ d.watts }} W</td>
            <td class="text-muted">{{ d.updated }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<h2 style="margin-top: 36px">Manuel Kontrol</h2>
<div class="grid">
  <div class="card">
    <h3>Cihaz Aç/Kapat</h3>
    <form
      action="{{ url_for('home_toggle') }}"
      method="POST"
      class="form-stacked"
      style="margin-top: 12px"
    >
      <label for="deviceId">Cihaz ID</label>
      <input
        type="text"
        id="deviceId"
        name="deviceId"
        placeholder="LIGHT-LIVINGROOM"
        required
        class="input"
      />
      <label for="state">Durum</label>
      <select id="state" name="state" class="select">
        <option value="on">Aç</option>
        <option value="off">Kapat</option>
      </select>
      <button type="submit" class="btn">Güncelle</button>
    </form>
  </div>

  <div class="card">
    <h3>Termostat Ayarı</h3>
    <form
      action="{{ url_for('home_thermostat') }}"
      method="POST"
      class="form-stacked"
      style="margin-top: 12px"
    >
      <label for="zone">Bölge</label>
      <input
        type="text"
        id="zone"
        name="zone"
        placeholder="Salon"
        required
        class="input"
      />
      <label for="target">Hedef Sıcaklık (°C)</label>
      <input
        type="number"
        step="0.1"
        id="target"
        name="target"
        placeholder="22.5"
        required
        class="input"
      />
      <button type="submit" class="btn">Ayarla</button>
    </form>
  </div>
</div>
{% endblock %}
