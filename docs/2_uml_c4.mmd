---
config:
  theme: neutral
---

C4Container
title DigiBank + Smart City - Container Diagram (docker-compose ile uyumlu)

Person(resident, "Resident", "GUI üzerinden bankacılık işlemleri ve smart-gov ödemeleri yapar.")
Person(admin, "System Admin", "GUI üzerinden user/transaction yönetir; export/metrics/forecast kullanır.")

Person_Ext(psa, "Public Safety Authority", "SensorSystem olaylarını alır (demo/console).")
Person_Ext(utility, "Public Utility Service", "SensorSystem olaylarını alır (demo/console).")

System_Boundary(platform, "DigiBank Platform") {
  Container(gui, "Web GUI", "Python 3.9 + Flask", "HTML arayüz; backend API'ye istek atar; rapor indirir/e-posta yollar.")
  Container(api, "Backend API", "Java 17 + HttpServer", "REST: /api/login, /api/bills, /api/pay, /api/transfer, /api/users*, /api/transactions*, /api/export, /api/metrics, /api/forecast, /api/home/*")

  ContainerDb(db, "Database", "PostgreSQL 14", "users ve transactions tabloları (opsiyonel; env varsa aktif).")
  Container(mailpit, "Mailpit", "SMTP catcher", "GUI'nin gönderdiği transaction e-postalarını yakalar.")

  Container(exportDir, "Export Folder", "Bind mount: ./txt -> /app/txt", "Backend /api/export çıktıları; DirectoryWatcherService bu klasörü izler.")
  Container(txFallback, "Fallback Tx Log", "data/transactions.log", "DB kapalıysa TransactionRepository append eder (konteyner FS).")

  Container(sensor, "SensorSystem", "Observer", "Demo olay üretimi ve observer'lara bildirim.")
  Container(city, "CityController", "Service", "Günlük rutin + command invoker + sensor tetikleri.")
}

Rel(resident, gui, "Kullanır", "HTTP")
Rel(admin, gui, "Kullanır (Admin ekranları)", "HTTP")

Rel(gui, api, "REST çağrıları", "HTTP")
Rel(gui, mailpit, "Transaction raporu e-postası gönderir", "SMTP")
Rel(admin, mailpit, "E-postaları görür", "HTTP")

Rel(api, db, "JDBC ile okur/yazar (env varsa)", "SQL")
Rel(api, exportDir, "TXT export yazar; watcher okur", "FS")
Rel(api, txFallback, "DB yoksa dosyaya append", "FS")

Rel(city, sensor, "Olay tetikler", "In-process")
Rel(sensor, psa, "Bildirim", "Notify")
Rel(sensor, utility, "Bildirim", "Notify")
