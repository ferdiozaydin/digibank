---
config:
  theme: neutral
---

erDiagram

    %% NOT:
    %% - Bu şema, docker-compose ile ayağa kalkan PostgreSQL (opsiyonel) tablolarını gösterir.
    %% - Smart city / sensor bileşenleri DB'ye yazmaz; olaylar demo/console ve AuditLogger ile takip edilir.
    %% - DB kapalıysa repository'ler in-memory + dosya fallback davranışı gösterebilir.

    USERS {
        bigint id PK "BIGSERIAL"
        string username "UNIQUE, NOT NULL"
        string password_hash "NOT NULL"
        string salt "NOT NULL"
        string totp_secret "NOT NULL"
        string role "RESIDENT | ADMIN | CONTROLLER"
        decimal fiat_balance "NUMERIC"
        decimal crypto_balance "NUMERIC"
        string pq_public_key
    }

    TRANSACTIONS {
        bigint id PK "BIGSERIAL"
        bigint user_id FK
        string description
        decimal amount "NUMERIC"
        string status "BASARILI | BASARISIZ | PENDING (demo)"
        datetime created_at
        string full_name
        string bank_code
        string address
        date record_date
    }

    USERS ||--o{ TRANSACTIONS : "has"
